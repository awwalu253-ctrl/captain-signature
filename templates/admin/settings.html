{% extends "base.html" %}

{% block content %}
<div class="settings-container">
    <!-- Header Section -->
    <div class="settings-header">
        <div class="header-content">
            <h1 class="page-title">Settings</h1>
            <p class="page-subtitle">Configure your store preferences</p>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('dashboard') }}" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                <span>Dashboard</span>
            </a>
        </div>
    </div>

    <!-- Settings Grid -->
    <form method="POST" action="{{ url_for('admin_settings') }}" id="settingsForm">
        <div class="settings-grid">
            <!-- Maintenance Mode Card -->
            <div class="settings-card maintenance-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-shield-halved"></i>
                    </div>
                    <div class="header-title">
                        <h3>Maintenance Mode</h3>
                        <p>Control site accessibility</p>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="toggle-section">
                        <div class="toggle-info">
                            <span class="toggle-label">Site Status</span>
                            <span class="status-badge {% if maintenance_config and maintenance_config.enabled %}status-active{% else %}status-inactive{% endif %}">
                                {% if maintenance_config and maintenance_config.enabled %}Active{% else %}Inactive{% endif %}
                            </span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" name="maintenance_enabled" id="maintenanceSwitch" 
                                   {% if maintenance_config and maintenance_config.enabled %}checked{% endif %}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="maintenance-options" id="maintenanceOptions" style="{% if not maintenance_config or not maintenance_config.enabled %}opacity: 0.5; pointer-events: none;{% endif %}">
                        <div class="input-group">
                            <label>
                                <i class="fas fa-message"></i>
                                <span>Message</span>
                            </label>
                            <textarea name="maintenance_message" placeholder="Enter maintenance message">{{ maintenance_config.message if maintenance_config and maintenance_config.message else 'We are currently performing scheduled maintenance.' }}</textarea>
                        </div>

                        <div class="input-group">
                            <label>
                                <i class="fas fa-clock"></i>
                                <span>Estimated Return</span>
                            </label>
                            <input type="text" name="estimated_return" value="{{ maintenance_config.estimated_return if maintenance_config and maintenance_config.estimated_return else '2-3 hours' }}" placeholder="e.g., 2 hours">
                        </div>

                        <div class="ips-section">
                            <label>
                                <i class="fas fa-shield"></i>
                                <span>Bypass IPs</span>
                            </label>
                            <div class="ip-list">
                                {% if maintenance_config and maintenance_config.allowed_ips %}
                                    {% for ip in maintenance_config.allowed_ips %}
                                        <span class="ip-badge">{{ ip }}</span>
                                    {% endfor %}
                                {% else %}
                                    <span class="no-ips">No IPs configured</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delivery Settings Card -->
            <div class="settings-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="header-title">
                        <h3>Delivery Settings</h3>
                        <p>Manage shipping costs</p>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="input-group">
                        <label>
                            <i class="fas fa-tag"></i>
                            <span>Delivery Fee</span>
                        </label>
                        <div class="currency-input">
                            <span class="currency-symbol">{{ settings.currency }}</span>
                            <input type="number" name="delivery_fee" value="{{ settings.delivery_fee }}" step="100" min="0" required>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>
                            <i class="fas fa-gift"></i>
                            <span>Free Delivery Threshold</span>
                        </label>
                        <div class="currency-input">
                            <span class="currency-symbol">{{ settings.currency }}</span>
                            <input type="number" name="free_delivery_threshold" value="{{ settings.free_delivery_threshold }}" step="1000" min="0">
                        </div>
                        <span class="input-hint">Set to 0 to disable</span>
                    </div>
                </div>
            </div>

            <!-- Store Information Card -->
            <div class="settings-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="header-title">
                        <h3>Store Information</h3>
                        <p>Basic store details</p>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="input-group">
                        <label>
                            <i class="fas fa-heading"></i>
                            <span>Store Name</span>
                        </label>
                        <input type="text" name="site_name" value="{{ settings.site_name }}" placeholder="Enter store name" required>
                    </div>

                    <div class="input-group">
                        <label>
                            <i class="fas fa-coins"></i>
                            <span>Currency Symbol</span>
                        </label>
                        <input type="text" name="currency" value="{{ settings.currency }}" maxlength="5" placeholder="₦, $, €" required>
                    </div>
                </div>
            </div>

            <!-- Analytics Card -->
            <div class="settings-card analytics-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="header-title">
                        <h3>Quick Analytics</h3>
                        <p>Real-time store performance</p>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="metric-grid">
                        <div class="metric-item">
                            <span class="metric-label">Avg. Order Value</span>
                            <span class="metric-value">{{ settings.currency }}{{ "%.0f"|format(avg_order_value|default(0)) }}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Orders (30d)</span>
                            <span class="metric-value">{{ orders_30_days|default(0) }}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Conversion Rate</span>
                            <span class="metric-value">{{ "%.1f"|format(conversion_rate|default(0)) }}%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Active Products</span>
                            <span class="metric-value">{{ active_products|default(0) }}</span>
                        </div>
                    </div>
                    <div class="metric-footer" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(184, 155, 94, 0.1);">
                        <div class="metric-item" style="background: none; padding: 0;">
                            <span class="metric-label">Total Revenue (30d)</span>
                            <span class="metric-value" style="font-size: 1.2rem;">{{ settings.currency }}{{ "%.0f"|format(revenue_30_days|default(0)) }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Status Card -->
            <div class="settings-card security-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="header-title">
                        <h3>Security Status</h3>
                        <p>System protection</p>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="security-item">
                        <div class="security-info">
                            <i class="fas fa-check-circle"></i>
                            <span>SSL Certificate</span>
                        </div>
                        <span class="security-status valid">Valid</span>
                    </div>
                    <div class="security-item">
                        <div class="security-info">
                            <i class="fas fa-shield"></i>
                            <span>Firewall</span>
                        </div>
                        <span class="security-status active">Active</span>
                    </div>
                    <div class="security-item">
                        <div class="security-info">
                            <i class="fas fa-database"></i>
                            <span>Daily Backups</span>
                        </div>
                        <span class="security-status enabled">Enabled</span>
                    </div>
                </div>
            </div>

            <!-- Last Updated Card -->
            <div class="settings-card update-card">
                <div class="card-body">
                    <i class="fas fa-clock"></i>
                    <div class="update-info">
                        <span class="update-label">Last Updated</span>
                        <span class="update-time">
                            {% if settings.updated_at %}
                                {{ settings.updated_at.strftime('%B %d, %Y at %I:%M %p') }}
                            {% else %}
                                Never
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Footer -->
        <div class="settings-footer">
            <button type="submit" class="btn-save">
                <i class="fas fa-check"></i>
                <span>Save Changes</span>
            </button>
        </div>
    </form>
</div>

<style>
/* Premium Settings Page Styles */
.settings-container {
    max-width: 1400px;
    margin: 2rem auto;
    padding: 0 2rem;
}

/* Header Styles */
.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 3rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(184, 155, 94, 0.2);
}

.header-content {
    flex: 1;
}

.page-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 3rem;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0;
    line-height: 1.2;
    letter-spacing: -0.02em;
}

.page-subtitle {
    font-size: 1rem;
    color: #666;
    margin: 0.5rem 0 0;
    font-weight: 300;
    letter-spacing: 0.3px;
}

.btn-back {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1.5rem;
    background: white;
    border: 1px solid rgba(184, 155, 94, 0.3);
    border-radius: 40px;
    color: #1a1a1a;
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: 500;
    transition: all 0.2s ease;
}

.btn-back:hover {
    background: #1a1a1a;
    border-color: #1a1a1a;
    color: white;
}

/* Settings Grid */
.settings-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

/* Settings Card */
.settings-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
    border: 1px solid rgba(184, 155, 94, 0.1);
    transition: all 0.2s ease;
}

.settings-card:hover {
    border-color: rgba(184, 155, 94, 0.3);
    box-shadow: 0 8px 30px rgba(184, 155, 94, 0.05);
}

.card-header {
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid rgba(184, 155, 94, 0.1);
    background: rgba(184, 155, 94, 0.02);
}

.header-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, rgba(184, 155, 94, 0.1), rgba(184, 155, 94, 0.05));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.header-icon i {
    font-size: 1.5rem;
    color: #B89B5E;
}

.header-title h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.3rem;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0 0 0.25rem;
}

.header-title p {
    font-size: 0.85rem;
    color: #666;
    margin: 0;
    font-weight: 300;
}

.card-body {
    padding: 1.5rem;
}

/* Input Groups */
.input-group {
    margin-bottom: 1.5rem;
}

.input-group:last-child {
    margin-bottom: 0;
}

.input-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 0.5rem;
}

.input-group label i {
    color: #B89B5E;
    font-size: 0.9rem;
}

.input-group input,
.input-group textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    font-size: 0.95rem;
    transition: all 0.2s ease;
    background: white;
}

.input-group textarea {
    min-height: 80px;
    resize: vertical;
}

.input-group input:focus,
.input-group textarea:focus {
    outline: none;
    border-color: #B89B5E;
    box-shadow: 0 0 0 3px rgba(184, 155, 94, 0.1);
}

.currency-input {
    display: flex;
    align-items: center;
    gap: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    overflow: hidden;
}

.currency-symbol {
    padding: 0.75rem 1rem;
    background: rgba(184, 155, 94, 0.1);
    color: #B89B5E;
    font-weight: 600;
    border-right: 1px solid rgba(0, 0, 0, 0.1);
}

.currency-input input {
    border: none;
    border-radius: 0;
    flex: 1;
}

.currency-input input:focus {
    box-shadow: none;
}

.input-hint {
    display: block;
    font-size: 0.8rem;
    color: #666;
    margin-top: 0.5rem;
}

/* Toggle Section */
.toggle-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(184, 155, 94, 0.1);
}

.toggle-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.toggle-label {
    font-size: 0.95rem;
    font-weight: 500;
    color: #1a1a1a;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 40px;
    font-size: 0.8rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-active {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.status-inactive {
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #e0e0e0;
    transition: .2s;
    border-radius: 30px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 24px;
    width: 24px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .2s;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

input:checked + .toggle-slider {
    background-color: #B89B5E;
}

input:checked + .toggle-slider:before {
    transform: translateX(30px);
}

/* Maintenance Options */
.maintenance-options {
    transition: opacity 0.2s ease;
}

/* IP List */
.ips-section {
    margin-top: 1.5rem;
}

.ips-section label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 0.75rem;
}

.ips-section label i {
    color: #B89B5E;
}

.ip-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.ip-badge {
    padding: 0.4rem 0.75rem;
    background: rgba(184, 155, 94, 0.1);
    border-radius: 8px;
    font-size: 0.85rem;
    font-family: monospace;
    color: #B89B5E;
    border: 1px solid rgba(184, 155, 94, 0.2);
}

.no-ips {
    font-size: 0.9rem;
    color: #999;
    font-style: italic;
}

/* Analytics Card */
.metric-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.metric-item {
    padding: 1rem;
    background: rgba(184, 155, 94, 0.02);
    border-radius: 12px;
}

.metric-label {
    display: block;
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.metric-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 600;
    color: #1a1a1a;
    font-family: 'Cormorant Garamond', serif;
}

.metric-footer {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(184, 155, 94, 0.1);
}

/* Security Card */
.security-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(184, 155, 94, 0.1);
}

.security-item:last-child {
    border-bottom: none;
}

.security-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.security-info i {
    color: #B89B5E;
    font-size: 1rem;
}

.security-info span {
    font-size: 0.95rem;
    color: #1a1a1a;
}

.security-status {
    font-size: 0.85rem;
    font-weight: 500;
}

.security-status.valid,
.security-status.active,
.security-status.enabled {
    color: #28a745;
}

/* Update Card */
.update-card .card-body {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
}

.update-card i {
    font-size: 1.5rem;
    color: #B89B5E;
}

.update-info {
    flex: 1;
}

.update-label {
    display: block;
    font-size: 0.8rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
}

.update-time {
    display: block;
    font-size: 0.95rem;
    color: #1a1a1a;
    font-weight: 500;
}

/* Settings Footer */
.settings-footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 2rem;
}

.btn-save {
    display: inline-flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 2.5rem;
    background: #1a1a1a;
    border: none;
    border-radius: 50px;
    color: white;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.btn-save:hover {
    background: #B89B5E;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(184, 155, 94, 0.3);
}

.btn-save i {
    font-size: 1.1rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .settings-grid {
        grid-template-columns: 1fr;
    }
    
    .settings-container {
        padding: 0 1.5rem;
    }
    
    .page-title {
        font-size: 2.5rem;
    }
}

@media (max-width: 768px) {
    .settings-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .header-actions {
        width: 100%;
    }
    
    .btn-back {
        width: 100%;
        justify-content: center;
    }
    
    .page-title {
        font-size: 2rem;
    }
    
    .card-header {
        padding: 1.25rem;
    }
    
    .card-body {
        padding: 1.25rem;
    }
    
    .metric-grid {
        grid-template-columns: 1fr;
    }
}

/* Flash Messages */
.alert {
    margin-bottom: 2rem;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    border-left: 4px solid;
}

.alert-success {
    background: rgba(40, 167, 69, 0.05);
    border-left-color: #28a745;
}

.alert-danger {
    background: rgba(220, 53, 69, 0.05);
    border-left-color: #dc3545;
}

.alert-info {
    background: rgba(184, 155, 94, 0.05);
    border-left-color: #B89B5E;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Maintenance toggle
    const maintenanceSwitch = document.getElementById('maintenanceSwitch');
    const maintenanceOptions = document.getElementById('maintenanceOptions');
    const statusBadge = document.querySelector('.status-badge');
    
    if (maintenanceSwitch) {
        maintenanceSwitch.addEventListener('change', function() {
            if (this.checked) {
                maintenanceOptions.style.opacity = '1';
                maintenanceOptions.style.pointerEvents = 'all';
                statusBadge.textContent = 'Active';
                statusBadge.className = 'status-badge status-active';
            } else {
                maintenanceOptions.style.opacity = '0.5';
                maintenanceOptions.style.pointerEvents = 'none';
                statusBadge.textContent = 'Inactive';
                statusBadge.className = 'status-badge status-inactive';
            }
        });
    }
    
    // Auto-hide flash messages
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.transition = 'opacity 0.3s ease';
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 300);
        }, 4000);
    });
});
</script>
{% endblock %}